# Implementation Plan

- [x] 1. 型定義の追加と既存型の拡張
  - 通知タイミングの単位を表す列挙型（分前・時間前・日前・週間前）を定義する
  - 通知設定を表す型（一意キー・数値・単位）を定義する
  - 表示ラベルマッピング（内部英語値 → 日本語表示名）の定数を定義する
  - 既存のイベントレコード型に通知設定フィールドを追加する
  - 既存のカレンダーイベント型にオプショナルな通知設定フィールドを追加する
  - イベント作成・更新の入力型にオプショナルな通知設定フィールドを追加する
  - イベントレコードからカレンダーイベントへの変換関数で通知設定を引き継ぐよう更新する
  - _Requirements: 3.1, 3.2, 3.3, 3.4_

- [x] 2. NotificationField コンポーネントの作成
- [x] 2.1 (P) 通知設定 UI の構築とアクセシビリティ対応
  - 数値入力（1〜99）と単位選択ドロップダウンの横並びレイアウトで通知タイミングを入力できるようにする
  - 追加ボタンの押下で通知をリストに追加する。コンポーネントは数値と単位のみを親に渡し、一意キーの生成は親（フック）に委譲する
  - 設定済み通知をチップ（バッジ）形式で一覧表示し、各チップに削除ボタンを配置する
  - 通知が10件に達した場合、追加操作を無効化し上限メッセージを表示する
  - 数値が範囲外（1未満または99超）の場合、エラーメッセージを表示して追加を拒否する
  - 同一の数値と単位の組み合わせが既に存在する場合、重複エラーを表示する
  - 各チップに通知内容を説明する ARIA ラベルを設定する
  - セクション全体に件数と上限を読み上げるための ARIA 属性を設定する
  - 通知の追加・削除時にライブリージョンで操作結果をスクリーンリーダーに通知する
  - キーボードのみで通知の追加・削除操作を完了できるようにする
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.5, 1.6, 4.1, 4.2, 4.3, 4.4, 5.1_

- [x] 2.2 Storybook ストーリーの作成
  - 通知なしの初期状態、複数通知が設定済みの状態、10件上限に達した状態のストーリーを作成する
  - CSF3 形式で autodocs タグを設定し、既存コンポーネントのストーリーパターンに準拠する
  - _Requirements: 1.1, 1.3, 1.5_

- [x] 2.3 単体テストの作成
  - 通知の追加・削除操作、上限制御、範囲バリデーション、重複チェックの動作をテストする
  - ARIA 属性の存在とライブリージョンの更新を検証する
  - キーボード操作（Enter による追加、チップ削除ボタンのフォーカスと実行）をテストする
  - 既存の EventForm テストパターン（Testing Library + vitest）に準拠する
  - _Requirements: 1.2, 1.3, 1.4, 1.5, 1.6, 4.1, 4.2, 4.3, 4.4, 5.1_

- [x] 3. (P) useEventForm フックの通知機能拡張
  - フォームデータに通知設定の配列を追加し、初期値として既存の通知データまたは空配列を設定する
  - 通知の追加メソッドを実装する：重複チェックと上限チェックの後、一意キーを自動生成して配列に追加し、成功・失敗を呼び出し元に返す
  - 通知の削除メソッドを実装する：指定されたキーに一致する通知を配列から除去する
  - フォームリセット時に通知配列を空にリセットする
  - 通知追加・削除の状態管理、重複検出、上限制御の単体テストを作成する
  - _Requirements: 1.2, 1.6, 2.2, 5.1_

- [x] 4. (P) EventService の通知データ永続化対応
  - イベント作成時に通知設定を JSONB カラムに保存する処理を追加する（未指定時は空配列をデフォルト）
  - イベント更新時に通知設定が指定されている場合のみ上書き保存する処理を追加する
  - 通知設定なし（0件 / 空配列）でもイベントを正常に保存できることを保証する
  - 通知データ付きのイベント作成・更新・空配列保存の単体テストを作成する
  - _Requirements: 2.1, 2.3, 2.4, 5.2, 5.3_

- [ ] 5. フォーム・ダイアログ統合と動作検証
  - EventForm に NotificationField を組み込み、useEventForm の通知操作メソッドと接続する
  - EventDialog のフォームデータからサービス入力型への変換関数に通知データの受け渡しを追加する
  - 編集モードでイベントを開いた際に、保存済みの通知設定をフォームに復元表示する
  - 通知を追加して保存 → 再編集で復元されることを確認する統合テストを作成する
  - 既存の EventForm Storybook ストーリーに通知設定付きのバリアントを追加する
  - _Requirements: 1.1, 2.1, 2.2, 2.3, 2.4_
